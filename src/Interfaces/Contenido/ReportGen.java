package Interfaces.Contenido;

import java.awt.Color;
import javax.swing.JOptionPane;
import javax.swing.border.LineBorder;
import ControladorBD.QueriesAlberto;
import ControladorBD.BDConexion;
import java.sql.Connection;
import java.util.HashMap;
import java.util.Map;
import static javax.swing.WindowConstants.DISPOSE_ON_CLOSE;
import net.sf.jasperreports.engine.JasperFillManager;
import net.sf.jasperreports.engine.JasperPrint;
import net.sf.jasperreports.engine.JasperReport;
import net.sf.jasperreports.engine.util.JRLoader;
import net.sf.jasperreports.view.JasperViewer;

public class ReportGen extends javax.swing.JPanel {

    ProcedimientosExtra listen = new ProcedimientosExtra();
    Dialogo diag = new Dialogo ();
    QueriesAlberto query = new QueriesAlberto();
    BDConexion conexion = new BDConexion();
    
    public ReportGen() {
        initComponents();

        listen.FieldListener(IdMiem);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        IdMiem = new javax.swing.JTextField();
        Label = new javax.swing.JLabel();
        GenRep = new javax.swing.JButton();

        setMaximumSize(new java.awt.Dimension(707, 541));
        setMinimumSize(new java.awt.Dimension(707, 541));
        setPreferredSize(new java.awt.Dimension(707, 541));

        jLabel1.setFont(new java.awt.Font("Times New Roman", 1, 18)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(51, 51, 51));
        jLabel1.setText("I.D del miembro");

        IdMiem.setFont(new java.awt.Font("Times New Roman", 1, 18)); // NOI18N
        IdMiem.setForeground(new java.awt.Color(204, 204, 255));
        IdMiem.setText("Ej. 58698569");
        IdMiem.setBorder(javax.swing.BorderFactory.createLineBorder(java.awt.Color.gray));
        IdMiem.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                IdMiemKeyTyped(evt);
            }
        });

        Label.setFont(new java.awt.Font("Times New Roman", 0, 10)); // NOI18N
        Label.setForeground(new java.awt.Color(255, 0, 0));
        Label.setText("(*)");
        Label.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        Label.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                LabelMouseEntered(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                LabelMouseExited(evt);
            }
        });

        GenRep.setFont(new java.awt.Font("Times New Roman", 1, 18)); // NOI18N
        GenRep.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Images/Icono-PDF.png"))); // NOI18N
        GenRep.setText("Generar reporte");
        GenRep.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                GenRepActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(GenRep))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(110, 110, 110)
                        .addComponent(jLabel1)
                        .addGap(18, 18, 18)
                        .addComponent(IdMiem, javax.swing.GroupLayout.DEFAULT_SIZE, 320, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(Label)))
                .addGap(116, 116, 116))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(86, 86, 86)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(IdMiem, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(Label))
                .addGap(101, 101, 101)
                .addComponent(GenRep, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(290, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void LabelMouseEntered(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_LabelMouseEntered
        // TODO add your handling code here:
        diag.posicion(Label.getLocationOnScreen().x-29, Label.getLocationOnScreen().y+15);
        diag.setVisible(true);
    }//GEN-LAST:event_LabelMouseEntered

    private void LabelMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_LabelMouseExited
        // TODO add your handling code here:
        diag.setVisible(false);
    }//GEN-LAST:event_LabelMouseExited

    private void IdMiemKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_IdMiemKeyTyped
        // TODO add your handling code here:
                          char c = evt.getKeyChar();
        
        if (c < '0' || c > '9' || IdMiem.getText().length() > 9){
            evt.consume();
        }
    }//GEN-LAST:event_IdMiemKeyTyped

    public boolean val(){
        if (IdMiem.getText().equals("Ej. 58698569")){
            JOptionPane.showMessageDialog(null, "Debe rellenar todos los campos que son obligatorios", "Error", JOptionPane.ERROR_MESSAGE);
            return false;
        }
        if (!query.ciExist(Integer.parseInt(IdMiem.getText()))){
            JOptionPane.showMessageDialog(null, "Dicho miembro no existe", "Error", JOptionPane.ERROR_MESSAGE);
            return false;
        }
        return true;
    }
    
    private void GenRepActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_GenRepActionPerformed
        // TODO add your handling code here:
        if (val()){
            try (Connection con = conexion.getConnection()){

                JasperReport reporte = null;
                String path = "src\\Reportes\\ReportGenMiem.jasper";

                Map parametro = new HashMap();
                parametro.put("cedula", Integer.parseInt(IdMiem.getText()));

                reporte =  (JasperReport) JRLoader.loadObjectFromFile(path);

                JasperPrint jprint = JasperFillManager.fillReport(path, parametro, con);

                JasperViewer view = new JasperViewer(jprint, false);

                view.setDefaultCloseOperation(DISPOSE_ON_CLOSE);

                view.setVisible(true);

            }  catch (Exception e) {

                JOptionPane.showMessageDialog(null, e, "Error", JOptionPane.ERROR_MESSAGE);

            }
        }
    }//GEN-LAST:event_GenRepActionPerformed

    public boolean ciExist(int ced){        
        //return query.ciExist(ced);
        return true;
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    public javax.swing.JButton GenRep;
    private javax.swing.JTextField IdMiem;
    private javax.swing.JLabel Label;
    private javax.swing.JLabel jLabel1;
    // End of variables declaration//GEN-END:variables
}
